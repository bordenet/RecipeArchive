#!/bin/sh
# PRD Protection Hook - Prevents accidental deletion of critical Product Requirements Documents
# This script ensures that the four foundational PRD documents cannot be deleted

PRD_FILES=(
  "docs/requirements/browser-extension.md"
  "docs/requirements/aws-backend.md" 
  "docs/requirements/website.md"
  "docs/requirements/ios-app.md"
)

echo "ğŸ›¡ï¸  Checking PRD document protection..."

# Check if any PRD files are being deleted
for file in "${PRD_FILES[@]}"; do
  if git diff --cached --name-status | grep -q "^D.*$file"; then
    echo "âŒ CRITICAL ERROR: Attempt to delete protected PRD document: $file"
    echo "ğŸš« PRD documents are foundational requirements and cannot be deleted"
    echo "ğŸ’¡ If you need to modify a PRD, edit the content instead of deleting"
    echo "ğŸ“‹ Protected PRD documents:"
    printf "   â€¢ %s\n" "${PRD_FILES[@]}"
    exit 1
  fi
done

# Check if PRD files exist and warn if any are missing
missing_prds=()
for file in "${PRD_FILES[@]}"; do
  if [ ! -f "$file" ]; then
    missing_prds+=("$file")
  fi
done

if [ ${#missing_prds[@]} -gt 0 ]; then
  echo "âš ï¸  WARNING: Missing critical PRD documents:"
  printf "   â€¢ %s\n" "${missing_prds[@]}"
  echo "ğŸ”§ These documents are required for development consistency"
  echo "ğŸ“ Consider creating missing PRDs before committing"
fi

# Check if docs/requirements directory exists
if [ ! -d "docs/requirements" ]; then
  echo "âŒ CRITICAL ERROR: docs/requirements directory is missing"
  echo "ğŸ—ï¸  This directory must exist to house PRD documents"
  echo "ğŸ’¡ Run: mkdir -p docs/requirements"
  exit 1
fi

echo "âœ… PRD document protection check passed"
