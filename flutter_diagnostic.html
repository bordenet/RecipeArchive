<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Flutter Web Diagnostic</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #f5f5f5;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .test-result {
      padding: 10px;
      margin: 10px 0;
      border-radius: 4px;
      border-left: 4px solid;
    }
    .pass {
      background: #d4edda;
      border-color: #28a745;
      color: #155724;
    }
    .fail {
      background: #f8d7da;
      border-color: #dc3545;
      color: #721c24;
    }
    .info {
      background: #d1ecf1;
      border-color: #17a2b8;
      color: #0c5460;
    }
    pre {
      background: #f8f9fa;
      padding: 10px;
      border-radius: 4px;
      overflow-x: auto;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üîç Flutter Web Diagnostic Tool</h1>
    <p>This will help us figure out why Flutter web isn't working on your system.</p>
    
    <div id="tests"></div>
    
    <h2>üõ†Ô∏è Potential Solutions</h2>
    <div id="solutions"></div>
  </div>

  <script>
    const testsDiv = document.getElementById('tests');
    const solutionsDiv = document.getElementById('solutions');
    
    function addTest(title, passed, details) {
      const className = passed ? 'pass' : 'fail';
      const icon = passed ? '‚úÖ' : '‚ùå';
      testsDiv.innerHTML += `
        <div class="test-result ${className}">
          <strong>${icon} ${title}</strong><br>
          ${details}
        </div>
      `;
    }
    
    function addInfo(content) {
      testsDiv.innerHTML += `
        <div class="test-result info">
          ${content}
        </div>
      `;
    }
    
    // Test 1: Basic JavaScript
    try {
      const testArray = [1, 2, 3];
      const result = testArray.map(x => x * 2);
      addTest('Basic JavaScript', true, 'ES6 features work correctly');
    } catch (e) {
      addTest('Basic JavaScript', false, `Error: ${e.message}`);
    }
    
    // Test 2: Web APIs
    const hasWebApis = typeof fetch !== 'undefined' && typeof Promise !== 'undefined';
    addTest('Modern Web APIs', hasWebApis, hasWebApis ? 'fetch and Promise available' : 'Missing modern web APIs');
    
    // Test 3: Service Worker support
    const hasServiceWorker = 'serviceWorker' in navigator;
    addTest('Service Worker Support', hasServiceWorker, hasServiceWorker ? 'Service Workers supported' : 'Service Workers not supported');
    
    // Test 4: WebAssembly support
    const hasWasm = typeof WebAssembly !== 'undefined';
    addTest('WebAssembly Support', hasWasm, hasWasm ? 'WASM supported' : 'WASM not supported');
    
    // Test 5: Browser info
    addInfo(`
      <strong>üåê Browser Information:</strong><br>
      User Agent: ${navigator.userAgent}<br>
      Platform: ${navigator.platform}<br>
      Language: ${navigator.language}<br>
      Cookies Enabled: ${navigator.cookieEnabled}<br>
      Online: ${navigator.onLine}
    `);
    
    // Test 6: Try to load Flutter.js manually
    addInfo('<strong>üß™ Testing Flutter.js loading...</strong>');
    
    // Test 7: Check for console errors
    const originalError = console.error;
    const errors = [];
    console.error = function(...args) {
      errors.push(args.join(' '));
      originalError.apply(console, arguments);
    };
    
    // Test 8: Try to mimic Flutter initialization
    setTimeout(() => {
      if (errors.length > 0) {
        addTest('JavaScript Console', false, `Errors detected: ${errors.join(', ')}`);
      } else {
        addTest('JavaScript Console', true, 'No JavaScript errors detected');
      }
      
      // Add solutions based on results
      let solutions = '<h3>üîß Recommended Fixes:</h3>';
      
      if (!hasServiceWorker) {
        solutions += '<p><strong>1. Browser Compatibility:</strong> Your browser may not support Flutter web. Try Chrome, Firefox, or Safari.</p>';
      }
      
      if (!hasWasm) {
        solutions += '<p><strong>2. WebAssembly:</strong> Enable WebAssembly in browser settings or update your browser.</p>';
      }
      
      solutions += `
        <p><strong>3. Clear Browser Cache:</strong> Press Cmd+Shift+R (Mac) or Ctrl+Shift+R (Windows) to hard refresh.</p>
        <p><strong>4. Try Incognito Mode:</strong> Test in private/incognito browsing to rule out extensions.</p>
        <p><strong>5. Different Browser:</strong> Try Safari, Firefox, or Edge.</p>
        <p><strong>6. Flutter Channel:</strong> Try switching Flutter to stable channel: <code>flutter channel stable && flutter upgrade</code></p>
        <p><strong>7. Local HTTPS:</strong> Some features require HTTPS. Try: <code>flutter run -d chrome --web-hostname localhost --web-port 8080</code></p>
      `;
      
      solutions += `
        <h3>üìä Quick Test Commands:</h3>
        <pre>
# Test Flutter doctor
flutter doctor -v

# Test fresh project with debug
cd /tmp
flutter create debug_web_test
cd debug_web_test  
flutter run -d chrome --verbose

# Check Flutter channel
flutter channel
        </pre>
      `;
      
      solutionsDiv.innerHTML = solutions;
    }, 1000);
    
    // Test if we can access Flutter ports
    async function testPorts() {
      const ports = [9003, 9005, 8080];
      for (const port of ports) {
        try {
          const response = await fetch(`http://localhost:${port}/`, { method: 'HEAD' });
          addTest(`Port ${port} Access`, true, `HTTP ${response.status}`);
        } catch (e) {
          addTest(`Port ${port} Access`, false, `Cannot connect: ${e.message}`);
        }
      }
    }
    
    setTimeout(testPorts, 500);
  </script>
</body>
</html>
