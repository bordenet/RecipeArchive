<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LocalStorage Debug Tool</title>
    <style>
        body {
            font-family: 'Monaco', 'Consolas', monospace;
            margin: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .storage-item {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
        }
        .key {
            font-weight: bold;
            color: #495057;
            margin-bottom: 8px;
        }
        .value {
            background: #e9ecef;
            padding: 10px;
            border-radius: 3px;
            white-space: pre-wrap;
            word-break: break-all;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .highlight {
            background: #fff3cd;
            border-color: #ffeaa7;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç LocalStorage Debug Tool</h1>
        <p>This tool shows all localStorage items to help debug recipe storage.</p>
        
        <button onclick="refresh()">üîÑ Refresh</button>
        <button onclick="clearRecipes()">üóëÔ∏è Clear Recipe Data</button>
        <button onclick="testStore()">üß™ Test Store Recipe</button>
        
        <div id="content">
            <p>Loading...</p>
        </div>
    </div>

    <script>
        function refresh() {
            const content = document.getElementById('content');
            let html = '<h2>üìã All LocalStorage Items:</h2>';
            
            if (localStorage.length === 0) {
                html += '<p><em>No items in localStorage</em></p>';
            } else {
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    const value = localStorage.getItem(key);
                    
                    const isRecipeRelated = key.includes('recipe') || key.includes('Recipe');
                    const itemClass = isRecipeRelated ? 'storage-item highlight' : 'storage-item';
                    
                    html += `
                        <div class="${itemClass}">
                            <div class="key">${key}</div>
                            <div class="value">${value}</div>
                        </div>
                    `;
                }
            }
            
            // Add debug info about current context
            html += '<h2>üîß Debug Information:</h2>';
            html += `
                <div class="storage-item">
                    <div class="key">Current URL</div>
                    <div class="value">${window.location.href}</div>
                </div>
                <div class="storage-item">
                    <div class="key">User Agent</div>
                    <div class="value">${navigator.userAgent}</div>
                </div>
                <div class="storage-item">
                    <div class="key">LocalStorage Length</div>
                    <div class="value">${localStorage.length}</div>
                </div>
            `;
            
            content.innerHTML = html;
        }
        
        function clearRecipes() {
            const keys = [];
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.includes('recipe') || key.includes('Recipe')) {
                    keys.push(key);
                }
            }
            
            keys.forEach(key => localStorage.removeItem(key));
            alert(`Cleared ${keys.length} recipe-related items`);
            refresh();
        }
        
        function testStore() {
            const testRecipe = {
                id: "test-" + Date.now(),
                userId: "test-user",
                title: "Test Recipe from Debug Tool",
                ingredients: ["Test ingredient 1", "Test ingredient 2"],
                steps: ["Test step 1", "Test step 2"],
                attributionUrl: "https://example.com/test",
                domain: "example.com",
                createdAt: new Date().toISOString(),
                source: "debug-tool",
                status: "test"
            };
            
            const storageKey = `recipeArchive.recipes.test-user`;
            const existingRecipes = JSON.parse(localStorage.getItem(storageKey) || '[]');
            existingRecipes.push(testRecipe);
            localStorage.setItem(storageKey, JSON.stringify(existingRecipes));
            
            alert('Test recipe stored!');
            refresh();
        }
        
        // Load on page load
        document.addEventListener('DOMContentLoaded', refresh);
    </script>
</body>
</html>